generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/client"
}

datasource db {
  provider = "postgresql"
}

model Carga {
  id              String   @id @default(cuid())
  viagem          String   @unique  // Business key
  tipoTransporte  String
  origem          String
  destino         String
  produto         String
  equipamento     String
  prevColeta      String   // Store as string, parse if needed
  qtdeEntregas    String
  vrFrete         String   // May be empty
  termino         String
  status          String   @default("ACTIVE") // 'ACTIVE' | 'ARCHIVED'
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  historico       CargaHistorico[]
  
  @@index([viagem])
  @@index([createdAt])
  @@index([status])
}

model CargaHistorico {
  id              String   @id @default(cuid())
  cargaId         String
  carga           Carga    @relation(fields: [cargaId], references: [id], onDelete: Cascade)
  
  viagem          String
  tipoTransporte  String
  origem          String
  destino         String
  produto         String
  equipamento     String
  prevColeta      String
  qtdeEntregas    String
  vrFrete         String
  termino         String
  status          String   @default("ACTIVE")
  
  changeType      String   // 'CREATED' | 'UPDATED'
  changedAt       DateTime @default(now())
  
  @@index([cargaId])
  @@index([viagem])
  @@index([changedAt])
}

model ScraperLog {
  id            String   @id @default(cuid())
  level         String   // 'INFO' | 'WARN' | 'ERROR' | 'DEBUG'
  message       String
  context       String?  // Additional context as JSON string
  error         String?  // Error stack trace if applicable
  executionId   String?  // Group logs by execution
  timestamp     DateTime @default(now())

  @@index([level])
  @@index([executionId])
  @@index([timestamp])
}

model PageView {
  id          String   @id @default(cuid())
  page        String   // Page identifier (e.g., 'overview', 'historico')
  sessionId   String?  // Optional session identifier for analytics
  userAgent   String?  // Browser/client info
  timestamp   DateTime @default(now())

  @@index([page, timestamp])
  @@index([timestamp])
}
